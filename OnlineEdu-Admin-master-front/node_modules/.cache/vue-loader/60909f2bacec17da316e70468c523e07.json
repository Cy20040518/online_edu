{"remainingRequest":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\src\\views\\hm_banner\\hmbanner_list.vue?vue&type=style&index=1&id=4d0b2659&scoped=true&lang=scss","dependencies":[{"path":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\src\\views\\hm_banner\\hmbanner_list.vue","mtime":1646101641000},{"path":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86193\\Desktop\\OnlineEdu-Admin-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5iYW5uZXItaW1nIHsKICB3aWR0aDogMzYwcHg7CiAgaGVpZ2h0OiAxMjBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmN2ZhOwogIGxpbmUtaGVpZ2h0OiAxMjBweDsKfQo="},{"version":3,"sources":["hmbanner_list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8RA;AACA;AACA;AACA;AACA;AACA","file":"hmbanner_list.vue","sourceRoot":"src/views/hm_banner","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-row :gutter=\"20\">\n      <!-- 添加/编辑 -->\n      <el-col :xs=\"24\" :sm=\"9\">\n        <el-card>\n          <div slot=\"header\">{{ isAdd ? '添加' : '修改' }}Banner</div>\n          <el-form label-position=\"top\" :model=\"addOrUpdateData\" size=\"small\">\n            <el-form-item label=\"Banner海报：\">\n              <el-upload\n                action=\"\"\n                :auto-upload=\"false\"\n                :show-file-list=\"false\"\n                accept=\".png, .jpg, .jpeg\"\n                :on-change=\"selectBanner\"\n              >\n                <el-image :src=\"encodeOssFileUri(addOrUpdateData.imageUrl)\" fit=\"cover\" class=\"banner-img\">\n                  <div slot=\"error\" class=\"image-slot\">\n                    <i class=\"el-icon-picture-outline\" />\n                  </div>\n                </el-image>\n              </el-upload>\n              <div class=\"input-tips\">点击上传海报，图片不能超过2MB</div>\n            </el-form-item>\n            <el-form-item label=\"Banner标题：\" prop=\"title\">\n              <el-input v-model=\"addOrUpdateData.title\" />\n            </el-form-item>\n            <el-form-item label=\"Banner链接：\" prop=\"linkUrl\">\n              <el-input v-model=\"addOrUpdateData.linkUrl\" placeholder=\"请附带http[s]://前缀\" />\n            </el-form-item>\n            <el-form-item label=\"Banner排序：\" prop=\"sort\">\n              <el-input-number v-model=\"addOrUpdateData.sort\" controls-position=\"right\" style=\"width: 100%\" />\n            </el-form-item>\n            <el-form-item label=\"Banner状态：\" prop=\"enable\">\n              <el-radio-group v-model=\"addOrUpdateData.enable\" style=\"position: absolute;top: -22px;left: 120px;\">\n                <el-radio :label=\"true\">启用</el-radio>\n                <el-radio :label=\"false\">禁用</el-radio>\n              </el-radio-group>\n            </el-form-item>\n            <el-form-item>\n              <el-button-group>\n                <el-button type=\"primary\" @click=\"isAdd?createBanner():updateBanner()\">\n                  {{ isAdd ? '保 存' : '更 新' }}\n                </el-button>\n                <el-button v-if=\"!isAdd\" @click=\"resetForm\">返回添加</el-button>\n              </el-button-group>\n            </el-form-item>\n          </el-form>\n        </el-card>\n      </el-col>\n      <!-- 友链列表 -->\n      <el-col :xs=\"24\" :sm=\"15\">\n        <el-card>\n          <div slot=\"header\">Banner列表</div>\n          <!-- 搜索框 -->\n          <div class=\"search-box\">\n            <el-form ref=\"searchParamsForm\" :inline=\"true\" :model=\"searchParams\" size=\"small\">\n              <el-form-item label=\"标题：\" prop=\"title\">\n                <el-input v-model=\"searchParams.title\" placeholder=\"输入标题搜索\" />\n              </el-form-item>\n              <el-form-item label=\"状态：\" prop=\"enable\">\n                <el-select v-model=\"searchParams.enable\" style=\"width: 130px\">\n                  <el-option label=\"启用\" :value=\"true\" />\n                  <el-option label=\"禁用\" :value=\"false\" />\n                </el-select>\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" @click=\"getList\">查 询</el-button>\n                <el-button @click=\"resetSearchParams('searchParamsForm')\">重 置</el-button>\n                <el-button type=\"success\" icon=\"el-icon-refresh\" @click=\"refreshDialogVisible=true\">刷新缓存</el-button>\n              </el-form-item>\n            </el-form>\n          </div>\n          <!-- 列表数据 -->\n          <el-table\n            ref=\"listTable\"\n            v-loading=\"tableDataLoading\"\n            :data=\"listData\"\n            tooltip-effect=\"dark\"\n            :header-cell-style=\"{fontWeight:'normal', color:'#666'}\"\n          >\n            <el-table-column prop=\"title\" label=\"标题\" show-tooltip-when-overflow>\n              <template slot-scope=\"scope\">\n                <el-link target=\"_blank\" type=\"primary\" :href=\"scope.row.linkUrl\" :underline=\"false\">\n                  {{ scope.row.title }}\n                </el-link>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"sort\" label=\"排序\" width=\"100\" align=\"center\" />\n            <el-table-column prop=\"enable\" label=\"状态\" width=\"160\" align=\"center\">\n              <template slot-scope=\"scope\">\n                <el-switch\n                  v-model=\"scope.row.enable\"\n                  active-color=\"#13ce66\"\n                  inactive-color=\"#ff4949\"\n                  active-text=\"正常\"\n                  inactive-text=\"禁用\"\n                  :active-value=\"true\"\n                  :inactive-value=\"false\"\n                  @change=\"disenablle(scope.$index)\"\n                />\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\" width=\"180\">\n              <template slot-scope=\"scope\">\n                <el-button type=\"primary\" size=\"mini\" @click=\"tryUpdate(scope.$index)\">查看/编辑</el-button>\n                <el-popconfirm\n                  placement=\"top-start\"\n                  confirm-button-text=\"确定\"\n                  cancel-button-text=\"取消\"\n                  icon=\"el-icon-info\"\n                  icon-color=\"red\"\n                  :title=\"`您要永久删除Banner[${scope.row.title}]吗？`\"\n                  style=\"margin-left: 10px\"\n                  @confirm=\"deleteBanner(scope.$index)\"\n                >\n                  <el-button slot=\"reference\" type=\"danger\" size=\"mini\">删除</el-button>\n                </el-popconfirm>\n              </template>\n            </el-table-column>\n          </el-table>\n          <div class=\"clearfix\">\n            <div class=\"pagination \">\n              <el-pagination\n                background\n                :page-sizes=\"[10, 20, 30, 40,50]\"\n                layout=\"total, sizes, prev, pager, next, jumper\"\n                :total=\"total\"\n                :page-size.sync=\"searchParams.pageSize\"\n                :current-page.sync=\"searchParams.current\"\n                @size-change=\"getList\"\n                @current-change=\"getList\"\n              />\n            </div>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n    <div>\n      <el-dialog\n        title=\"刷新Banner缓存\"\n        :visible.sync=\"refreshDialogVisible\"\n        destroy-on-close\n        width=\"30%\"\n      >\n        <div style=\"margin-bottom: 10px\">\n          <span style=\"color: red\">该操作会使缓存中的Banner数据失效</span>\n          <br><br>\n          <span>同时会重新获取数据库中所有<strong>未禁用的</strong>Banner数据来刷新缓存</span>\n        </div>\n        <span slot=\"footer\">\n          <el-button type=\"primary\" size=\"small\" @click=\"refresh\">确 认</el-button>\n          <el-button size=\"small\" @click=\"refreshDialogVisible = false\">取 消</el-button>\n        </span>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport { list, disable, enable, createBanner, deleteBanner, updateBanner, refresh } from '@/api/banner'\nimport { encodeOssFileUri, jsonObj2FormData } from '@/utils'\n\nexport default {\n  name: 'HmBannerList',\n  data() {\n    return {\n      searchParams: {\n        current: 1,\n        pageSize: 10,\n        enable: null,\n        title: ''\n      },\n      total: 0,\n      listData: [],\n      tableDataLoading: false,\n      isAdd: true,\n      addOrUpdateData: {\n        title: '',\n        imageUrl: '',\n        linkUrl: '',\n        sort: 0,\n        enable: true\n      },\n      refreshDialogVisible: false\n    }\n  },\n  created() {\n    this.getList()\n  },\n  methods: {\n    resetSearchParams(formName) {\n      this.$refs[formName].resetFields()\n      this.searchParams.current = 1\n      this.getList()\n    },\n    resetForm() {\n      this.isAdd = true\n      this.addOrUpdateData = {\n        title: '',\n        imageUrl: '',\n        linkUrl: '',\n        sort: 0,\n        enable: true\n      }\n    },\n    encodeOssFileUri(ossUri) {\n      return encodeOssFileUri(ossUri)\n    },\n    operationSuccess(msg) {\n      this.$message.success(msg)\n      this.resetForm()\n      this.getList()\n    },\n    tryUpdate(index) {\n      this.isAdd = false\n      this.addOrUpdateData = JSON.parse(JSON.stringify(this.listData[index]))\n    },\n    selectBanner(file) {\n      this.addOrUpdateData.imageUrl = URL.createObjectURL(file.raw)\n      this.addOrUpdateData.file = file.raw\n    },\n    // 获取列表信息\n    getList() {\n      this.tableDataLoading = true\n      list(this.searchParams).then(resp => {\n        this.total = resp.data.total\n        this.listData = resp.data.list\n      })\n      this.tableDataLoading = false\n    },\n    // 刷新Banner缓存\n    refresh() {\n      refresh().then(resp => {\n        this.$message.success(resp.message)\n      })\n      this.refreshDialogVisible = false\n    },\n    // 启用或禁用用户\n    disenablle(index) {\n      const banner = this.listData[index]\n      const fun = banner.enable ? enable : disable\n      fun(banner.id).then(resp => {\n        const msg = 'Banner[' + banner.title + ']已' + (banner.enable ? '启用' : '禁用')\n        if (banner.enable) {\n          this.$message.success(msg)\n        } else {\n          this.$message.warning(msg)\n        }\n      })\n    },\n    // 删除\n    deleteBanner(index) {\n      const id = this.listData[index].id\n      deleteBanner(id).then(resp => {\n        this.operationSuccess(resp.message)\n      })\n    },\n    // 创建\n    createBanner() {\n      const params = jsonObj2FormData(this.addOrUpdateData)\n      createBanner(params).then(resp => {\n        this.operationSuccess(resp.message)\n      })\n    },\n    // 更新\n    updateBanner() {\n      const params = jsonObj2FormData(this.addOrUpdateData)\n      updateBanner(params).then(resp => {\n        this.operationSuccess(resp.message)\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.el-card {\n  &__header, &__body {\n    padding: 12px 12px;\n  }\n}\n</style>\n\n<style scoped lang=\"scss\">\n.banner-img {\n  width: 360px;\n  height: 120px;\n  background-color: #f5f7fa;\n  line-height: 120px;\n}\n</style>\n"]}]}